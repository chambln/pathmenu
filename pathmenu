#!/usr/bin/env rc

fn main {

    fn la {
        printf %s\n . ..
        ls
    }

    fn iter {
        for (i in $*) @ {
            if (test -d $i && !~ $i . && cd $i) {
                $0 `{ la | dmenu -p `pwd}
            } else realpath $i
        }
    }

    if (~ $* ()) {
        iter ./
    } else {
        for (i in $*) {
            iter $^i/
        }
    }

}

ifs = $nl

BASE_DIR = `pwd
fn pwd { realpath --relative-base=$BASE_DIR . }

main $*
