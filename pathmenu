#!/bin/sh

_ls() {
    printf '%s\n' .. .
    /bin/ls
}

iter() {
    choices="$(_ls | dmenu -l 8)"
    for choice in $choices; do (
        if [ -d "$choice" ] && cd "$choice"; then
            iter
        else
            printf '%s\n' "$PWD/$choice"
        fi
    ) done
}

set -f; IFS='
'
for i in "${@:-.}"; do
    ( cd "$i" && iter )
done
