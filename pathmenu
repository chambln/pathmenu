#!/usr/bin/env rc

fn iter {
    for (i in $*) @ {
        if (test -d $i && !~ $i . && cd $i) {
            $0 `{ la | dmenu -i -l 20 -p `pwd }
        } else realpath $i
    }
}

fn main {
    ifs = $nl
    BASE_DIR=`pwd
    fn realpath { builtin realpath -m --relative-base=$BASE_DIR $* }
    fn pwd { realpath . }
    fn la { printf %s\n .. . `{ls --color=no} }
    if (~ $*)
        iter ./  # Start in working dir if no args passed.
    for (i in $*)
        ~ $i . && iter ./ || iter $i
}

main $*
