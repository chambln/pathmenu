#!/usr/bin/env rc

fn iter {
    for (i in $*) @ {
        if (test -d $i && !~ $i . && cd $i) {
            $0 `{ ls | dmenu -i -l 20 -p `pwd }
        } else realpath $i
    }
}

ifs = $nl
BASE_DIR=`pwd
fn pwd { realpath --relative-base=$BASE_DIR . }
fn ls { printf %s\n . .. `{builtin ls} }
if (~ $* ())
    iter ./
for (i in $*)
    ~ $i . && iter ./ || iter $i
